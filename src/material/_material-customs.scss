/* ----------------------------------------------------------------------------------------------------- */
/*  @ Angular Material CDK helpers & overrides
/* ----------------------------------------------------------------------------------------------------- */

/* ----------------------------------------------------------------------------------------------------- */
/*  @ Form fields
/* ----------------------------------------------------------------------------------------------------- */

.mat-form-field.mat-form-field-appearance-fill {
  /* Disabled */
  &.mat-form-field-disabled {
    opacity: 0.7 !important;
  }

  /* Invalid */
  &.mat-form-field-invalid {
    .mat-form-field-wrapper {
      /* Border color */
      .mat-form-field-flex {
        @apply border-danger dark:border-danger #{'!important'};
      }
    }
  }

  /* Focused */
  &.mat-focused {
    .mat-form-field-wrapper {
      /* Background color */
    }
  }

  /* Focused and valid fields */
  &.mat-focused:not(.mat-form-field-invalid) {
    .mat-form-field-wrapper {
      /* Border color */
      .mat-form-field-flex {
        @apply border-primary dark:border-primary #{'!important'};
      }
    }
  }

  /* Disable floating mat-label */
  &.mat-form-field-has-label.mat-form-field-can-float.mat-form-field-should-float {
    .mat-form-field-label-wrapper {
      .mat-form-field-label {
        width: 100% !important;
        transform: none !important;
      }
    }
  }

  /* Default style tweaks and enhancements */
  .mat-form-field-wrapper {
    margin-bottom: 16px;
    padding-bottom: 0;

    .mat-form-field-flex {
      position: relative;
      display: flex;
      align-items: stretch;
      min-height: 48px;
      border-radius: 6px;
      padding: 0 16px;
      border-width: 2px;
      @apply shadow-sm bg-white border-gray-300 dark:bg-black dark:bg-opacity-5 dark:border-gray-500 #{'!important'};

      .mat-form-field-prefix {
        > .mat-icon {
          margin-right: 12px;
        }

        > .mat-icon-button {
          margin: 0 4px 0 -10px;
        }

        > .mat-select {
          margin-right: 10px;
        }

        > .mat-datepicker-toggle {
          margin-left: -8px;
        }

        > *:not(.mat-icon):not(.mat-icon-button):not(.mat-select):not(.mat-datepicker-toggle) {
          margin-right: 12px;
        }
      }

      .mat-form-field-suffix {
        > .mat-icon {
          margin-left: 12px;
        }

        > .mat-icon-button {
          margin: 0 -10px 0 4px;
        }

        > .mat-select {
          margin-left: 10px;
        }

        > .mat-datepicker-toggle {
          margin-right: -8px;
        }
      }

      .mat-datepicker-toggle {
        margin-right: -8px;
      }

      .mat-form-field-prefix,
      .mat-form-field-suffix {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        @apply text-gray-400 #{'!important'};

        .mat-icon-button {
          width: 40px;
          min-width: 40px;
          height: 40px;
          min-height: 40px;
        }

        .mat-icon,
        .mat-icon-button:not(.mat-button-disabled),
        .mat-select-value {
          @apply text-gray-400;
        }

        /* Remove the margins from the mat-icon if it's inside a button */
        /* Force the icon size to 24 */
        .mat-button,
        .mat-raised-button,
        .mat-icon-button,
        .mat-stroked-button,
        .mat-flat-button,
        .mat-fab,
        .mat-mini-fab {
          .mat-icon {
            margin: 0 !important;
            @apply icon-size-6;
          }
        }

        /* Datepicker default icon size */
        .mat-datepicker-toggle-default-icon {
          @apply icon-size-6;
        }

        /* Make mat-select usable as prefix and suffix */
        .mat-select {
          display: flex;
          align-items: center;

          &:focus {
            .mat-select-trigger {
              .mat-select-value {
                @apply text-primary #{'!important'};
              }

              .mat-select-arrow-wrapper {
                .mat-select-arrow {
                  border-top-color: var(--primary) !important;
                }
              }
            }
          }

          .mat-select-trigger {
            display: flex;
            align-items: center;

            .mat-select-value {
              display: flex;
              max-width: none;

              mat-select-trigger {
                .mat-icon {
                  margin: 0 !important;
                }
              }
            }

            .mat-select-arrow-wrapper {
              display: flex;
              align-items: center;
              transform: none;
              margin-left: 4px;

              .mat-select-arrow {
                min-height: 0;
                @apply text-gray-500 dark:text-gray-400 #{'!important'};
              }
            }
          }
        }
      }

      .mat-form-field-infix {
        position: static;
        display: flex;
        align-items: center;
        width: 88px;
        padding: 0;
        border: 0;

        .mat-input-element {
          padding: 14px 0;
          margin-top: 0;
        }

        /* Textarea */
        textarea.mat-input-element {
          display: flex;
          align-self: stretch;
          min-height: 36px;
          height: auto;
          margin: 14px 0;
          padding: 0 6px 0 0;
          transform: none;
        }

        /* Select */
        .mat-select {
          display: inline-flex;

          .mat-select-trigger {
            display: inline-flex;
            align-items: center;
            width: 100%;

            .mat-select-value {
              display: flex;
              position: relative;
              max-width: none;

              .mat-select-value-text {
                display: inline-flex;

                > * {
                  overflow: hidden;
                  white-space: nowrap;
                  text-overflow: ellipsis;
                }
              }
            }
          }

          .mat-select-arrow-wrapper {
            transform: translateY(0);

            .mat-select-arrow {
              margin: 0 0 0 8px;
            }
          }
        }

        /* Chips */
        .mat-chip-list {
          width: 100%;
          margin: 0 -8px;

          .mat-chip-input {
            margin: 0 0 0 8px;
          }
        }

        .mat-form-field-label-wrapper {
          top: -25px;
          height: auto;
          padding-top: 0;
          overflow: visible;
          pointer-events: auto;

          .mat-form-field-label {
            position: relative;
            top: 0;
            margin-top: 0;
            backface-visibility: hidden;
            transition: none;
            font-weight: 500;
            @apply text-secondary #{'!important'};
          }
        }
      }

      /* mat-progress-spinner inside buttons */
      .mat-progress-spinner {
        &.mat-progress-spinner-indeterminate-animation[mode="indeterminate"] {
          circle {
            stroke: currentColor !important;
          }
        }
      }
    }

    /* Remove the underline */
    .mat-form-field-underline {
      display: none;
    }

    /* Subscript tweaks */
    .mat-form-field-subscript-wrapper {
      position: relative;
      top: auto;
      padding: 0;
      margin-top: 0;
      font-size: 12px;
      font-weight: 500;

      // > div {
      //   display: contents; /* Remove the div from flow to stop the subscript animation */
      // }

      .mat-error,
      .mat-hint {
        display: block;
        margin-top: 4px;
      }

      .mat-hint {
        @apply text-gray-400 #{'!important'};
      }
    }
  }

  /* Adjustments for mat-label */
  &.mat-form-field-has-label {
    .mat-form-field-wrapper {
      margin-top: 24px;
    }
  }

  /* Remove the default arrow for native select */
  &.mat-form-field-type-mat-native-select {
    .mat-form-field-infix {
      select {
        top: auto;
        margin-top: 0;
        margin-bottom: 0;
        padding-top: 0;
        padding-right: 18px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2364748B' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right -7px center;
        background-size: 24px;

        .dark & {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2397a6ba' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
        }
      }

      &:after {
        display: none;
      }
    }
  }

  /* Adds better alignment for textarea inputs */
  &.mat-textarea {
    .mat-form-field-wrapper {
      .mat-form-field-flex {
        .mat-form-field-prefix,
        .mat-form-field-suffix {
          align-items: flex-start;
        }

        .mat-form-field-prefix {
          padding-top: 12px;
        }

        .mat-form-field-suffix {
          padding-top: 12px;
        }
      }
    }
  }

  /* Removes subscript space */
  &.mat-no-subscript {
    .mat-form-field-wrapper {
      padding-bottom: 0;
      margin-bottom: 0;

      .mat-form-field-subscript-wrapper {
        display: none !important;
        height: 0 !important;
      }
    }
  }
}

/* Fix the outline appearance */
.mat-form-field.mat-form-field-appearance-outline {
  .mat-form-field-flex {
    .mat-form-field-outline {
      @apply text-gray-300 dark:text-gray-500;
    }
  }

  .mat-form-field-label {
    text-transform: uppercase;
    font-weight: 500;
  }
}

/* ----------------------------------------------------------------------------------------------------- */
/*  @ Inputs
/* ----------------------------------------------------------------------------------------------------- */
.mat-input-element {
  &::placeholder {
    transition: none !important;
    @apply text-gray-400 #{'!important'};
  }

  &::-moz-placeholder {
    transition: none !important;
    @apply text-gray-400 #{'!important'};
  }

  &::-webkit-input-placeholder {
    transition: none !important;
    @apply text-gray-400 #{'!important'};
  }

  &:-ms-input-placeholder {
    transition: none !important;
    @apply text-gray-400 #{'!important'};
  }
}

/* ----------------------------------------------------------------------------------------------------- */
/*  @ Buttons
/* ----------------------------------------------------------------------------------------------------- */
.mat-button,
.mat-fab,
.mat-flat-button,
.mat-icon-button,
.mat-mini-fab,
.mat-raised-button,
.mat-stroked-button {
  display: inline-flex !important;
  align-items: center;
  justify-content: center;
  height: 40px;
  min-height: 40px;
  max-height: 40px;
  line-height: 1 !important;

  .mat-button-wrapper {
    position: relative;
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    height: 100%;
    z-index: 2; /* Move mat-button-wrapper above the ripple and focus overlay */
  }

  .mat-button-focus-overlay,
  .mat-button-ripple {
    z-index: 1;
  }

  &.btn--sm {
    height: 30px;
    min-height: 32px;
    max-height: 32px;
    padding: -0 14px;
  }

  &.btn--lg {
    font-size: 15px;
    height: 48px;
    min-height: 48px;
    max-height: 48px;
  }

  /* mat-progress-spinner inside buttons */
  .mat-progress-spinner {
    &.mat-progress-spinner-indeterminate-animation[mode="indeterminate"] {
      circle {
        stroke: currentColor !important;
      }
    }
  }
}

/* Colored background buttons */
.mat-flat-button,
.mat-raised-button,
.mat-fab,
.mat-mini-fab {
  .mat-icon {
    color: currentColor !important;
  }

  /* Add hover and focus style on all buttons */
  .mat-button-focus-overlay {
    @apply bg-gray-400 bg-opacity-20 dark:bg-black dark:bg-opacity-5 #{'!important'};
  }

  /* On palette colored buttons, use a darker color */
  &.mat-primary,
  &.mat-accent,
  &.mat-warn {
    .mat-button-focus-overlay {
      background-color: rgba(0, 0, 0, 0.1) !important;
    }
  }

  &:hover,
  &.cdk-keyboard-focused,
  &.cdk-program-focused {
    .mat-button-focus-overlay {
      opacity: 1 !important;
    }
  }

  @media (hover: none) {
    &:hover {
      .mat-button-focus-overlay {
        opacity: 0 !important;
      }
    }
  }

  &.mat-button-disabled {
    .mat-button-focus-overlay {
      opacity: 0 !important;
    }
  }
}

/* Transparent background buttons */
.mat-button,
.mat-icon-button,
.mat-stroked-button {
  /* Apply primary color */
  &.mat-primary:not(.mat-button-disabled) {
    .mat-icon {
      @apply text-primary #{'!important'};
    }
  }

  /* Apply accent color */
  &.mat-accent:not(.mat-button-disabled) {
    .mat-icon {
      @apply text-accent #{'!important'};
    }
  }

  /* Apply warn color */
  &.mat-warn:not(.mat-button-disabled) {
    .mat-icon {
      @apply text-warn #{'!important'};
    }
  }

  /* Add hover and focus styles */
  .mat-button-focus-overlay {
    @apply bg-gray-400 bg-opacity-20 dark:bg-black dark:bg-opacity-5 #{'!important'};
  }

  /* On primary colored buttons, use the primary color as focus overlay */
  &.mat-primary:not(.mat-button-disabled) {
    .mat-button-focus-overlay {
      @apply bg-primary #{'!important'};
    }
  }

  /* On accent colored buttons, use the accent color as focus overlay */
  &.mat-accent:not(.mat-button-disabled) {
    .mat-button-focus-overlay {
      @apply bg-accent #{'!important'};
    }
  }

  /* On warn colored buttons, use the warn color as focus overlay */
  &.mat-warn:not(.mat-button-disabled) {
    .mat-button-focus-overlay {
      @apply bg-warn #{'!important'};
    }
  }

  &.mat-primary:not(.mat-button-disabled),
  &.mat-accent:not(.mat-button-disabled),
  &.mat-warn:not(.mat-button-disabled) {
    &:hover,
    &.cdk-keyboard-focused,
    &.cdk-program-focused {
      .mat-button-focus-overlay {
        opacity: 0.1 !important;
      }
    }
  }

  &:hover,
  &.cdk-keyboard-focused,
  &.cdk-program-focused {
    .mat-button-focus-overlay {
      opacity: 1 !important;
    }
  }

  @media (hover: none) {
    &:hover {
      .mat-button-focus-overlay {
        opacity: 0 !important;
      }
    }
  }

  &.mat-button-disabled {
    .mat-button-focus-overlay {
      opacity: 0 !important;
    }
  }
}

/* Stroked buttons */
.mat-stroked-button {
  /* Border color */
  &:not(.mat-button-disabled) {
    @apply border-gray-300 dark:border-gray-500 #{'!important'};
  }

  &.mat-button-disabled {
    @apply border-gray-200 dark:border-gray-600 #{'!important'};
  }
}

/* ----------------------------------------------------------------------------------------------------- */
/*  @ Datepicker
/* ----------------------------------------------------------------------------------------------------- */

.mat-calendar {
  @apply leading-none;
}

/* Hover and active cell content background opacity */
.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover,
.cdk-keyboard-focused .mat-calendar-body-active,
.cdk-program-focused .mat-calendar-body-active {
  & > .mat-calendar-body-cell-content {
    &:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical) {
      @apply bg-primary bg-opacity-30 #{'!important'};
    }
  }
}
